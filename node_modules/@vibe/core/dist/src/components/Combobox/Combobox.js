import{slicedToArray as e,defineProperty as o}from"../../../_virtual/_rollupPluginBabelHelpers.js";import{camelCase as t,noop as i,isFunction as s}from"lodash-es";import r from"classnames";import n,{forwardRef as a,useRef as l,useState as c,useCallback as d,useMemo as m}from"react";import{getStyle as p}from"../../helpers/typesciptCssModulesHelper.js";import{getTestId as u,ComponentDefaultTestId as v}from"../../tests/testIds.js";import b from"../../hooks/useMergeRef.js";import f from"../Search/Search.js";import{BASE_SIZES as h}from"../../constants/sizes.js";import C from"../Button/Button.js";import x from"../Text/Text.js";import g from"./components/ComboboxOption/ComboboxOption.js";import{defaultFilter as I}from"./ComboboxService.js";import{ComboboxItems as y}from"./components/ComboboxItems/ComboboxItems.js";import{StickyCategoryHeader as O}from"./components/StickyCategoryHeader/StickyCategoryHeader.js";import{useItemsData as j,useKeyboardNavigation as N}from"./ComboboxHelpers/ComboboxHelpers.js";import{getOptionId as S}from"./helpers.js";import{withStaticProps as R}from"../../types/withStaticProps.js";import"../../utils/colors-vars-map.js";import{COMBOBOX_LISTBOX_ID as F}from"./components/ComboboxConstants.js";import H from"./Combobox.module.scss.js";var k=R(a((function(a,h){var g=a.className,R=void 0===g?"":g,k=a.optionClassName,E=void 0===k?"":k,A=a.searchWrapperClassName,L=a.searchIcon,M=a.id,w=void 0===M?"":M,T=a.placeholder,z=void 0===T?"":T,B=a.size,V=void 0===B?"medium":B,W=a.defaultVisualFocusFirstIndex,P=a.optionLineHeight,D=void 0===P?32:P,_=a.optionsListHeight,X=a.autoFocus,q=void 0!==X&&X,G=a.disabled,J=void 0!==G&&G,K=a.options,Q=void 0===K?[]:K,U=a.categories,Y=a.withCategoriesDivider,Z=void 0!==Y&&Y,$=a.noResultsMessage,ee=void 0===$?"No results found":$,oe=a.onAddNew,te=a.addNewLabel,ie=void 0===te?"Add new":te,se=a.onClick,re=void 0===se?function(e){}:se,ne=a.filter,ae=void 0===ne?I:ne,le=a.disableFilter,ce=void 0!==le&&le,de=a.filterValue,me=a.onFilterChanged,pe=a.loading,ue=void 0!==pe&&pe,ve=a.onOptionHover,be=void 0===ve?i:ve,fe=a.onOptionLeave,he=void 0===fe?i:fe,Ce=a.shouldScrollToSelectedItem,xe=void 0===Ce||Ce,ge=a.noResultsRenderer,Ie=a.stickyCategories,ye=void 0!==Ie&&Ie,Oe=a.optionRenderer,je=void 0===Oe?null:Oe,Ne=a.renderOnlyVisibleOptions,Se=void 0!==Ne&&Ne,Re=a.clearFilterOnSelection,Fe=void 0!==Re&&Re,He=a.maxOptionsWithoutScroll,ke=a.defaultFilter,Ee=void 0===ke?"":ke,Ae=a.searchInputAriaLabel,Le=void 0===Ae?"Search for content":Ae,Me=a["data-testid"],we=a.debounceRate,Te=a.searchInputRef,ze=a.renderAction,Be=a.hideRenderActionOnInput,Ve=l(null),We=l(null),Pe=b(h,Ve),De=b(We,Te),_e=c(de||Ee),Xe=e(_e,2),qe=Xe[0],Ge=Xe[1];void 0!==de&&de!==qe&&Ge(de);var Je=d((function(e){$e(-1),me&&me(e),Ge(e)}),[Ge,me]),Ke=d((function(e,o,t){be(e,o,t)}),[be]),Qe=m((function(){return ce?Q:ae(qe,Q)}),[Q,qe,ae,ce]),Ue=c(-1),Ye=e(Ue,2),Ze=Ye[0],$e=Ye[1],eo=d((function(e){return void 0!==e&&Qe[e]&&!Qe[e].disabled}),[Qe]),oo=d((function(){oe&&oe(qe),Ge("")}),[oe,qe,Ge]),to=Qe.length>0,io=qe.length>0;var so=c(),ro=e(so,2),no=ro[0],ao=ro[1],lo=d((function(e){var o,t;(null===(o=null==e?void 0:e.category)||void 0===o?void 0:o.label)!==no&&ao(null===(t=null==e?void 0:e.category)||void 0===t?void 0:t.label)}),[no]),co=j({categories:U,options:Qe,filterValue:qe,withCategoriesDivider:Z,optionLineHeight:D}),mo=co.items,po=co.itemsMap,uo=co.selectableItems,vo=d((function(e,o){re(uo[o]),eo(o)&&$e(o),Fe&&Je("")}),[re,uo,eo,Fe,Je]),bo=N({getOptionId:S,defaultVisualFocusFirstIndex:W,onClick:vo,isChildSelectable:eo,options:uo,inputRef:De}),fo=bo.visualFocusItemIndex,ho=bo.visualFocusItemId,Co=bo.onOptionClick;return n.createElement(x,{type:"text2",ref:Pe,className:r(H.combobox,R,p(H,t("size-"+V)),o(o({},H.empty,!to),H.stickyCategory,ye)),id:w,"data-testid":Me||u(v.COMBOBOX,w),ellipsis:!1},n.createElement("div",{className:H.comboboxList,style:{maxHeight:_}},n.createElement(f,{ref:De,value:qe,className:r(H.comboboxSearchWrapper,A),inputAriaLabel:Le,currentAriaResultId:ho,id:"combobox-search",placeholder:z,size:V,disabled:J,onChange:Je,autoFocus:q,loading:ue,searchIconName:L,ariaExpanded:io||to,ariaHasPopup:"listbox",searchResultsContainerId:w?"".concat(w,"-listbox"):F,debounceRate:we,renderAction:ze,hideRenderActionOnInput:Be}),ye&&n.createElement(O,{label:no}),to&&n.createElement(y,{stickyCategories:ye,categories:U,options:mo,itemsMap:po,optionClassName:E,optionRenderer:je,activeItemIndex:Ze,onActiveCategoryChanged:lo,onOptionClick:Co,onOptionEnter:Ke,onOptionLeave:he,optionLineHeight:D,shouldScrollToSelectedItem:xe,renderOnlyVisibleOptions:Se,maxOptionsWithoutScroll:He,visualFocusItemIndex:fo,id:w?"".concat(w,"-listbox"):F})),io&&!to&&!ue&&(ge?ge():n.createElement("div",{className:H.comboboxNoResults},n.createElement("div",{className:H.comboboxMessageWrapper},n.createElement("span",{className:H.comboboxMessage},ee)),oe&&!J&&n.createElement(C,{className:H.addNewButton,size:V,kind:"tertiary",onClick:oo},n.createElement("span",{className:H.buttonLabel},s(ie)?ie(qe):ie)))))})),{sizes:h,iconTypes:g.iconTypes});export{k as default};
//# sourceMappingURL=Combobox.js.map
