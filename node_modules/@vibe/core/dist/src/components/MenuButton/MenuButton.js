import{slicedToArray as e,defineProperty as o}from"../../../_virtual/_rollupPluginBabelHelpers.js";import i,{forwardRef as t,useRef as r,useState as n,useCallback as s,useMemo as a}from"react";import l from"classnames";import{camelCase as d}from"lodash-es";import{isForwardRef as g}from"react-is";import m from"../Dialog/Dialog.js";import c from"../DialogContentContainer/DialogContentContainer.js";import p from"../Tooltip/Tooltip.js";import u from"../../hooks/ssr/useIsomorphicLayoutEffect.js";import f from"../../hooks/useMergeRef.js";import{BUTTON_ICON_SIZE as h}from"../Button/ButtonConstants.js";import{withStaticProps as T}from"../../types/withStaticProps.js";import"../../utils/colors-vars-map.js";import{MenuButtonSize as v,MenuButtonComponentPosition as C}from"./MenuButtonConstants.js";import{DialogSize as E,DialogPosition as S,HideShowEvent as w}from"../Dialog/DialogConstants.js";import{NOOP as j}from"../../utils/function-utils.js";import{getStyle as O}from"../../helpers/typesciptCssModulesHelper.js";import{getTestId as y,ComponentDefaultTestId as b}from"../../tests/testIds.js";import M from"./MenuButton.module.scss.js";import P from"../../../icons/dist/react/Menu.js";var D={main:8,secondary:0},N=t((function(t,T){var v=t.id,C=t.className,E=t.openDialogComponentClassName,S=t.children,w=t.component,A=void 0===w?P:w,I=t.componentPosition,_=void 0===I?"start":I,x=t.size,z=void 0===x?"small":x,B=t.open,H=void 0!==B&&B,R=t.onClick,k=void 0===R?j:R,K=t.zIndex,L=void 0===K?null:K,U=t.ariaLabel,Y=void 0===U?"Menu":U,W=t.closeMenuOnItemClick,F=t.dialogOffset,V=void 0===F?D:F,q=t.dialogPosition,G=void 0===q?m.positions.BOTTOM_START:q,J=t.dialogClassName,Q=t.dialogPaddingSize,X=void 0===Q?c.sizes.SMALL:Q,Z=t.dialogShowTriggerIgnoreClass,$=t.dialogHideTriggerIgnoreClass,ee=t.onMenuHide,oe=void 0===ee?j:ee,ie=t.onMenuShow,te=void 0===ie?j:ie,re=t.disabled,ne=void 0!==re&&re,se=t.text,ae=t.tooltipContent,le=t.tooltipProps,de=t.tooltipTriggers,ge=void 0===de?[N.hideTriggers.MOUSE_LEAVE]:de,me=t.tooltipPosition,ce=void 0===me?"right":me,pe=t.startingEdge,ue=void 0===pe?"bottom":pe,fe=t.removeTabCloseTrigger,he=void 0!==fe&&fe,Te=t.tooltipReferenceClassName,ve=t.hideWhenReferenceHidden,Ce=void 0===ve||ve,Ee=t.dialogContainerSelector,Se=t.active,we=t.triggerElement,je=void 0===we?"button":we,Oe=t.showTooltipOnlyOnTriggerElement,ye=t["data-testid"],be=t.closeDialogOnContentClick,Me=void 0!==be&&be,Pe=r(null),De=f(T,Pe),Ne=n(H),Ae=e(Ne,2),Ie=Ae[0],_e=Ae[1],xe=null!=Se?Se:Ie,ze=s((function(e){oe(),_e(!1);var o=Pe.current;o&&e&&window.requestAnimationFrame((function(){o.focus()}))}),[oe]),Be=s((function(e){var o="Escape"===(null==e?void 0:e.key);(o||W)&&e.propagate&&ze(o)}),[W,ze]),He=s((function(e,o){ze(o===m.hideShowTriggers.ESCAPE_KEY)}),[ze]),Re=s((function(){_e(!0),te()}),[_e,te]),ke=a((function(){var e=new Set([m.hideShowTriggers.CLICK_OUTSIDE,m.hideShowTriggers.TAB_KEY,m.hideShowTriggers.ESCAPE_KEY]);return Me&&(e.add(m.hideShowTriggers.CONTENT_CLICK),e.add(m.hideShowTriggers.ENTER)),he&&e.delete(m.hideShowTriggers.TAB_KEY),[i.Children.toArray(S).map((function(o){if(!i.isValidElement(o))return null;var t={};return o.type&&o.type.supportFocusOnMount&&(t.focusOnMount=!0,e.delete(m.hideShowTriggers.ESCAPE_KEY)),o.type&&o.type.isMenu&&(t.onClose=Be),i.cloneElement(o,t)})),Array.from(e)]}),[S,Be,Me,he]),Ke=e(ke,2),Le=Ke[0],Ue=Ke[1],Ye=a((function(){return 0===Le.length?null:i.createElement(c,{size:X,type:c.types.POPOVER},Le)}),[Le,X]),We=a((function(){return Object.assign(Object.assign({},D),V)}),[V]),Fe=A,Ve=a((function(){switch(z){case"xxs":case"xs":return 16;case"small":case"medium":case"large":return h;default:return 24}}),[z]),qe=Fe?i.createElement(Fe,{size:""+Ve,role:"img","aria-hidden":"true"}):null;u((function(){_e(H)}),[H,_e]);var Ge="button"===je?{ref:De}:{active:xe,disabled:ne,ref:g(je)?De:void 0},Je=i.createElement(je,Object.assign({id:v,"data-testid":ye||y(b.MENU_BUTTON,v),type:"button",className:l(M.wrapper,C,O(M,d("size-".concat(z))),o(o(o(o({},M.active,xe),O(M,E),Ie&&E),M.disabled,ne),M.text,se)),"aria-haspopup":"true","aria-expanded":Ie,"aria-label":!se&&Y,onMouseUp:function(e){ne?e.currentTarget.blur():k(e)},"aria-disabled":ne},Ge),"start"===_&&qe,se&&i.createElement("span",{className:M.innerText},se),"end"===_&&qe),Qe=function(e){return i.createElement(m,{wrapperClassName:J,position:G,containerSelector:Ee,startingEdge:ue,animationType:"expand",content:Ye,moveBy:We,showTrigger:ne?[]:["click","enter"],hideTrigger:Ue,showTriggerIgnoreClass:Z,hideTriggerIgnoreClass:$,useDerivedStateFromProps:!0,onDialogDidShow:Re,onDialogDidHide:He,zIndex:L,isOpen:Ie,hideWhenReferenceHidden:Ce},e)},Xe=function(e){return i.createElement(p,Object.assign({content:ae,position:ce,showTrigger:"mouseenter",hideTrigger:ge,referenceWrapperClassName:Te,hideWhenReferenceHidden:Ce},le),e)};return Oe?Qe(Xe(Je)):Xe(Qe(Je))})),A=T(N,{sizes:v,paddingSizes:E,dialogPositions:S,hideTriggers:w,componentPositions:C});export{A as default};
//# sourceMappingURL=MenuButton.js.map
