{"version":3,"file":"Modal.js","sources":["../../../../../src/components/Modal/Modal/Modal.tsx"],"sourcesContent":["import React, { forwardRef, useCallback, useMemo, useRef, useState } from \"react\";\nimport cx from \"classnames\";\nimport { RemoveScroll } from \"react-remove-scroll\";\nimport FocusLock from \"react-focus-lock\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { getTestId } from \"../../../tests/test-ids-utils\";\nimport { ComponentDefaultTestId } from \"../../../tests/constants\";\nimport styles from \"./Modal.module.scss\";\nimport { ModalProps } from \"./Modal.types\";\nimport ModalTopActions from \"../ModalTopActions/ModalTopActions\";\nimport { getStyle } from \"../../../helpers/typesciptCssModulesHelper\";\nimport { camelCase } from \"lodash-es\";\nimport { ModalProvider } from \"../context/ModalContext\";\nimport { ModalProviderValue } from \"../context/ModalContext.types\";\nimport { keyCodes } from \"../../../constants\";\nimport {\n  modalAnimationAnchorPopVariants,\n  modalAnimationCenterPopVariants,\n  modalAnimationFullViewVariants,\n  modalAnimationOverlayVariants\n} from \"../utils/animationVariants\";\nimport { createPortal } from \"react-dom\";\nimport usePortalTarget from \"../hooks/usePortalTarget/usePortalTarget\";\nimport { LayerProvider } from \"../../LayerProvider\";\nimport useMergeRef from \"../../../hooks/useMergeRef\";\n\n// @ts-expect-error This is a precaution to support all possible module systems (ESM/CJS)\nconst FocusLockComponent = (FocusLock.default || FocusLock) as typeof FocusLock;\n\nconst Modal = forwardRef(\n  (\n    {\n      id,\n      show,\n      size = \"medium\",\n      renderHeaderAction,\n      closeButtonTheme,\n      closeButtonAriaLabel,\n      onClose = () => {},\n      anchorElementRef,\n      alertModal,\n      container = document.body,\n      children,\n      style,\n      zIndex,\n      className,\n      \"data-testid\": dataTestId,\n      \"aria-labelledby\": ariaLabelledby,\n      \"aria-describedby\": ariaDescribedby\n    }: ModalProps,\n    ref: React.ForwardedRef<HTMLDivElement>\n  ) => {\n    const portalTargetElement = usePortalTarget(container);\n\n    const modalRef = useRef<HTMLDivElement>(null);\n    const modalMergedRef = useMergeRef<HTMLDivElement>(ref, modalRef);\n    const containerRef = useRef<HTMLDivElement>(null);\n\n    const [titleId, setTitleId] = useState<string>();\n    const [descriptionId, setDescriptionId] = useState<string>();\n\n    const setTitleIdCallback = useCallback(\n      (newId: string) => {\n        if (ariaLabelledby) return;\n        setTitleId(newId);\n      },\n      [ariaLabelledby]\n    );\n    const setDescriptionIdCallback = useCallback(\n      (newId: string) => {\n        if (ariaDescribedby) return;\n        setDescriptionId(newId);\n      },\n      [ariaDescribedby]\n    );\n\n    const contextValue = useMemo<ModalProviderValue>(\n      () => ({\n        modalId: id,\n        setTitleId: setTitleIdCallback,\n        setDescriptionId: setDescriptionIdCallback\n      }),\n      [id, setTitleIdCallback, setDescriptionIdCallback]\n    );\n\n    const onBackdropClick = useCallback<React.MouseEventHandler<HTMLDivElement>>(\n      e => {\n        if (!show || alertModal) return;\n        onClose(e);\n      },\n      [show, alertModal, onClose]\n    );\n\n    const onModalKeyDown = useCallback<React.KeyboardEventHandler<HTMLDivElement>>(\n      e => {\n        if (e.key !== keyCodes.ESCAPE || !show || alertModal) return;\n        onClose(e);\n      },\n      [alertModal, onClose, show]\n    );\n\n    const modalAnimationVariants =\n      size === \"full-view\"\n        ? modalAnimationFullViewVariants\n        : anchorElementRef?.current\n        ? modalAnimationAnchorPopVariants\n        : modalAnimationCenterPopVariants;\n\n    const zIndexStyle = zIndex ? ({ \"--monday-modal-z-index\": zIndex } as React.CSSProperties) : {};\n\n    return (\n      <AnimatePresence>\n        {show && (\n          <LayerProvider layerRef={containerRef}>\n            <ModalProvider value={contextValue}>\n              {createPortal(\n                <FocusLockComponent returnFocus>\n                  <div ref={containerRef} className={styles.container} style={zIndexStyle}>\n                    <motion.div\n                      variants={modalAnimationOverlayVariants}\n                      initial=\"initial\"\n                      animate=\"enter\"\n                      exit=\"exit\"\n                      data-testid={getTestId(ComponentDefaultTestId.MODAL_NEXT_OVERLAY, id)}\n                      className={styles.overlay}\n                      onClick={onBackdropClick}\n                      aria-hidden\n                    />\n                    <RemoveScroll forwardProps ref={modalMergedRef}>\n                      <motion.div\n                        variants={modalAnimationVariants}\n                        initial=\"exit\"\n                        animate=\"enter\"\n                        exit=\"exit\"\n                        custom={anchorElementRef}\n                        className={cx(\n                          styles.modal,\n                          getStyle(styles, camelCase(\"size-\" + size)),\n                          { [styles.withHeaderAction]: !!renderHeaderAction },\n                          className\n                        )}\n                        id={id}\n                        data-testid={dataTestId || getTestId(ComponentDefaultTestId.MODAL_NEXT, id)}\n                        role=\"dialog\"\n                        aria-modal\n                        aria-labelledby={ariaLabelledby || titleId}\n                        aria-describedby={ariaDescribedby || descriptionId}\n                        style={style}\n                        onKeyDown={onModalKeyDown}\n                        tabIndex={-1}\n                      >\n                        {children}\n                        <ModalTopActions\n                          renderAction={renderHeaderAction}\n                          theme={closeButtonTheme}\n                          closeButtonAriaLabel={closeButtonAriaLabel}\n                          onClose={onClose}\n                        />\n                      </motion.div>\n                    </RemoveScroll>\n                  </div>\n                </FocusLockComponent>,\n                portalTargetElement\n              )}\n            </ModalProvider>\n          </LayerProvider>\n        )}\n      </AnimatePresence>\n    );\n  }\n);\n\nexport default Modal;\n"],"names":["FocusLockComponent","FocusLock","default","Modal","forwardRef","_ref","ref","id","show","_ref$size","size","renderHeaderAction","closeButtonTheme","closeButtonAriaLabel","_ref$onClose","onClose","anchorElementRef","alertModal","_ref$container","container","document","body","children","style","zIndex","className","dataTestId","ariaLabelledby","ariaDescribedby","portalTargetElement","usePortalTarget","modalRef","useRef","modalMergedRef","useMergeRef","containerRef","_useState","useState","_useState2","_slicedToArray","titleId","setTitleId","_useState3","_useState4","descriptionId","setDescriptionId","setTitleIdCallback","useCallback","newId","setDescriptionIdCallback","contextValue","useMemo","modalId","onBackdropClick","e","onModalKeyDown","key","keyCodes","ESCAPE","modalAnimationVariants","modalAnimationFullViewVariants","current","modalAnimationAnchorPopVariants","modalAnimationCenterPopVariants","React","createElement","AnimatePresence","LayerProvider","layerRef","ModalProvider","value","createPortal","returnFocus","styles","motion","div","variants","modalAnimationOverlayVariants","initial","animate","exit","getTestId","ComponentDefaultTestId","MODAL_NEXT_OVERLAY","overlay","onClick","RemoveScroll","forwardProps","custom","cx","modal","getStyle","camelCase","_defineProperty","withHeaderAction","MODAL_NEXT","role","onKeyDown","tabIndex","ModalTopActions","renderAction","theme"],"mappings":"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"}