import{slicedToArray as e}from"../../../../_virtual/_rollupPluginBabelHelpers.js";import n from"classnames";import{SIZES as t}from"../../../constants/sizes.js";import s,{forwardRef as o,useRef as u,useState as i,useMemo as r,useCallback as l,useEffect as d}from"react";import c from"../../../hooks/useMergeRef.js";import a from"../../../hooks/ssr/useIsomorphicLayoutEffect.js";import m from"../../../hooks/useClickOutside/index.js";import p from"./hooks/useSubMenuIndex.js";import v from"./hooks/useOnCloseMenu.js";import f from"./hooks/useCloseMenuOnKeyEvent.js";import I from"./hooks/useMenuKeyboardNavigation.js";import M from"./hooks/useMouseLeave.js";import{useAdjacentSelectableMenuIndex as b}from"./hooks/useAdjacentSelectableMenuIndex.js";import{useFocusWithin as h}from"../../../hooks/useFocusWithin.js";import x from"../../../hooks/usePrevious/index.js";import{withStaticProps as S}from"../../../types/withStaticProps.js";import"../../../utils/colors-vars-map.js";import{getStyle as j}from"../../../helpers/typesciptCssModulesHelper.js";import{getTestId as O}from"../../../tests/testIds.js";import{ComponentDefaultTestId as k}from"../../../tests/constants.js";import{useFocusOnMount as g}from"./hooks/useFocusOnMount.js";import{useMenuId as C}from"./hooks/useMenuId.js";import{generateMenuItemId as y}from"./utils/utils.js";import E from"./Menu.module.scss.js";var A=o((function(t,o){var S=t.id,B=t.className,F=t.size,N=void 0===F?A.sizes.MEDIUM:F,P=t.tabIndex,D=void 0===P?0:P,L=t.ariaLabel,V=void 0===L?"Menu":L,z=t.ariaDescribedBy,R=t.children,T=t.isVisible,U=void 0===T||T,W=t.onClose,H=t.onItemFocus,K=t.focusOnMount,_=void 0!==K&&K,q=t.focusItemIndex,w=void 0===q?-1:q,G=t.focusItemIndexOnMount,J=void 0===G?-1:G,Q=t.isSubMenu,X=void 0!==Q&&Q,Y=t.useDocumentEventListeners,Z=void 0!==Y&&Y,$=t.shouldScrollMenu,ee=void 0!==$&&$,ne=t["data-testid"],te=u(null),se=c(te,o),oe=C(S),ue=u(null),ie=i(w),re=e(ie,2),le=re[0],de=re[1],ce=i(!1),ae=e(ce,2),me=ae[0],pe=ae[1],ve=r((function(){return s.Children.toArray(R).filter((function(e){return!!e.type.isMenuChild||(console.error("Menu child must be a menuChild item (such as MenuItem, MenuDivider, MenuTitle, etc). This child is not supported: ",e),!1)}))}),[R]),fe=l((function(e){var n,t,o;de(e);var u=ve[e],i=s.isValidElement(u)?(null===(n=null==u?void 0:u.props)||void 0===n?void 0:n.id)||"".concat(oe,"-item-").concat(e):void 0;i?null===(t=null==te?void 0:te.current)||void 0===t||t.setAttribute("aria-activedescendant",i):null===(o=null==te?void 0:te.current)||void 0===o||o.removeAttribute("aria-activedescendant")}),[ve,oe]),Ie=l((function(e){H&&H(e),fe(e),pe(!1)}),[fe,H]),Me=p(),be=Me.setSubMenuIsOpenByIndex,he=Me.hasOpenSubMenu,xe=Me.openSubMenuIndex,Se=Me.resetOpenSubMenuIndex,je=v({setActiveItemIndex:Ie,setOpenSubMenuIndex:Me.setOpenSubMenuIndex,onClose:W});m({ref:te,callback:function(){return je()}}),f({hasOpenSubMenu:he,onCloseMenu:je,ref:te,onClose:W,isSubMenu:X,useDocumentEventListeners:Z});var Oe=b({children:ve}),ke=Oe.getNextSelectableIndex,ge=Oe.getPreviousSelectableIndex;I({hasOpenSubMenu:he,getNextSelectableIndex:ke,getPreviousSelectableIndex:ge,activeItemIndex:le,setActiveItemIndex:Ie,isVisible:U,ref:te,useDocumentEventListeners:Z}),M({resetOpenSubMenuIndex:Se,hasOpenSubMenu:he,ref:te,setActiveItemIndex:Ie}),g({focusItemIndexOnMount:J,focusChildOnMount:ve[J],getNextSelectableIndex:ke,updateActiveItemIndex:fe,setIsInitialFocusSet:pe});var Ce=l((function(){pe(!0)}),[pe]),ye=x(he);d((function(){var e;he||Z||le>-1&&ye&&(null===(e=null==te?void 0:te.current)||void 0===e||e.focus())}),[le,he,ye,Z]),a((function(){_&&!Z&&requestAnimationFrame((function(){te&&te.current&&te.current.focus()}))}),[te,_,Z]);var Ee=h({onBlurWithin:function(){je&&je()}}).focusWithinProps;return s.createElement("ul",{onFocus:null==Ee?void 0:Ee.onFocus,onBlur:null==Ee?void 0:Ee.onBlur,id:oe,"data-testid":ne||O(k.MENU,S),className:n(E.menu,j(E,N),B),ref:se,tabIndex:D,"aria-label":V,role:"menu","aria-describedby":z,onMouseOver:Ce},ve&&s.Children.map(ve,(function(e,n){return s.isValidElement(e)?s.cloneElement(e,Object.assign(Object.assign({},null==e?void 0:e.props),{activeItemIndex:le,index:n,setActiveItemIndex:fe,menuRef:te,resetOpenSubMenuIndex:Se,isParentMenuVisible:U,setSubMenuIsOpenByIndex:be,hasOpenSubMenu:n===xe,closeMenu:je,id:y(oe,e,n),useDocumentEventListeners:Z,isInitialSelectedState:me,shouldScrollMenu:ee,getNextSelectableIndex:ke,getPreviousSelectableIndex:ge,isUnderSubMenu:X,splitMenuItemIconButtonRef:ue})):null})))}));Object.assign(A,{isMenu:!0,supportFocusOnMount:!0});var B=S(A,{sizes:t});export{B as default};
//# sourceMappingURL=Menu.js.map
