{"version":3,"file":"SplitButton.js","sources":["../../../../../src/components/SplitButton/SplitButton.tsx"],"sourcesContent":["/* eslint-disable react/jsx-props-no-spreading */\nimport { camelCase } from \"lodash-es\";\nimport { getStyle } from \"../../helpers/typesciptCssModulesHelper\";\nimport { ComponentDefaultTestId, getTestId } from \"../../tests/test-ids-utils\";\nimport cx from \"classnames\";\n// Libraries import\nimport React, { FC, ReactElement, useCallback, useMemo, useRef, useState } from \"react\";\n// Constants import\nimport {\n  DEFAULT_DIALOG_HIDE_TRIGGER,\n  DEFAULT_DIALOG_SHOW_TRIGGER,\n  DIALOG_MOVE_BY,\n  ENTER_KEYS,\n  SECONDARY_BUTTON_ARIA_LABEL,\n  SECONDARY_BUTTON_WRAPPER_CLASSNAME,\n  SplitButtonSecondaryContentPosition,\n  SplitButtonSecondaryContentPositionType\n} from \"./SplitButtonConstants\";\nimport { withStaticProps } from \"../../types\";\nimport { AnimationType, DialogPosition, HideShowEvent } from \"../Dialog/DialogConstants\";\n// Utils import\nimport { NOOP } from \"../../utils/function-utils\";\nimport { isInsideClass } from \"../../utils/dom-utils\";\n// Hooks import\nimport useKeyEvent from \"../../hooks/useKeyEvent\";\nimport useEventListener from \"../../hooks/useEventListener\";\n// Components import\nimport Button, { ButtonProps } from \"../Button/Button\";\nimport Dialog, { DialogEvent } from \"../Dialog/Dialog\";\nimport { DropdownChevronDown } from \"@vibe/icons\";\nimport DialogContentContainer from \"../DialogContentContainer/DialogContentContainer\";\nimport styles from \"./SplitButton.module.scss\";\nimport { DialogTriggerEvent } from \"../Dialog/Dialog.types\";\n\nexport interface SplitButtonProps extends ButtonProps {\n  /*\n   * The element or renderer which display inside the dialog which open by clicking on the split button's secondary button.\n   */\n  secondaryDialogContent?: ReactElement | (() => string | ReactElement);\n  onSecondaryDialogDidShow?: () => void;\n  onSecondaryDialogDidHide?: () => void;\n  zIndex?: number;\n  /*\n   * Class name to provide the element which wraps the popover/modal/dialog\n   */\n  secondaryDialogClassName?: string;\n  secondaryDialogPosition?: SplitButtonSecondaryContentPositionType;\n  /*\n    Popover Container padding size\n   */\n  dialogPaddingSize?: (typeof DialogContentContainer.sizes)[keyof typeof DialogContentContainer.sizes];\n  /**\n   * the container selector in which to append the dialog\n   * for examples: \"body\" , \".my-class\", \"#my-id\"\n   */\n  dialogContainerSelector?: string;\n  shouldCloseOnClickInsideDialog?: boolean;\n}\n\nconst SplitButton: FC<SplitButtonProps> & {\n  secondaryPositions?: typeof SplitButtonSecondaryContentPosition;\n  secondaryDialogPositions?: typeof SplitButtonSecondaryContentPosition;\n  sizes?: typeof Button.sizes;\n  colors?: typeof Button.colors;\n  kinds?: typeof Button.kinds;\n  inputTags?: typeof Button.inputTags;\n  dialogPaddingSizes?: typeof DialogContentContainer.sizes;\n} = ({\n  secondaryDialogContent,\n  onSecondaryDialogDidShow = NOOP,\n  onSecondaryDialogDidHide = NOOP,\n  shouldCloseOnClickInsideDialog,\n  zIndex = null,\n  secondaryDialogClassName,\n  secondaryDialogPosition = \"bottom-start\",\n  dialogContainerSelector,\n  dialogPaddingSize = DialogContentContainer.sizes.MEDIUM,\n  disabled,\n  // success mode not working right now, need to fix it in different pr\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  success,\n  loading,\n  kind,\n  color,\n  className,\n  leftIcon,\n  rightIcon,\n  onClick,\n  children,\n  marginLeft,\n  marginRight,\n  active,\n  id,\n  \"data-testid\": dataTestId,\n  ...buttonProps\n}: SplitButtonProps) => {\n  // State //\n  const [isDialogOpen, setDialogOpen] = useState(false);\n  const [isHovered, setIsHover] = useState(false);\n  const [isActive, setIsActive] = useState(false);\n\n  // Refs //\n  const ref = useRef(null);\n  const secondaryButtonRef = useRef(null);\n\n  // Callbacks //\n  const setHovered = useCallback(() => setIsHover(true), [setIsHover]);\n  const setNotHovered = useCallback(() => setIsHover(false), [setIsHover]);\n\n  const shouldSetActive = useCallback(\n    (e: React.KeyboardEvent<HTMLElement>) => {\n      if (disabled) return false;\n      return !isInsideClass(e.target as HTMLElement, SECONDARY_BUTTON_WRAPPER_CLASSNAME);\n    },\n    [disabled]\n  );\n\n  const setActive = useCallback(\n    (e: React.KeyboardEvent<HTMLElement>) => {\n      if (!shouldSetActive(e)) return;\n      setIsActive(true);\n    },\n    [setIsActive, shouldSetActive]\n  );\n  const setNotActive = useCallback(() => setIsActive(false), [setIsActive]);\n  const setActiveOnEnter = useCallback(\n    (e: React.KeyboardEvent<HTMLElement>) => {\n      if (!shouldSetActive(e)) return;\n      setIsActive(true);\n    },\n    [setIsActive, shouldSetActive]\n  );\n\n  const showDialog = useCallback(() => {\n    setDialogOpen(true);\n    onSecondaryDialogDidShow();\n  }, [setDialogOpen, onSecondaryDialogDidShow]);\n\n  const hideDialog = useCallback(\n    (_: DialogEvent, eventName: DialogTriggerEvent) => {\n      setDialogOpen(false);\n      onSecondaryDialogDidHide();\n      if (eventName === \"esckey\") {\n        secondaryButtonRef.current.focus();\n      }\n    },\n    [setDialogOpen, onSecondaryDialogDidHide]\n  );\n\n  // Event listeners //\n\n  // Used to set both buttons as hovered no matter what button was hovered\n  useEventListener({ eventName: \"mouseenter\", callback: setHovered, ref });\n  useEventListener({ eventName: \"mouseleave\", callback: setNotHovered, ref });\n\n  useEventListener({ eventName: \"mousedown\", callback: setActive, ref });\n  useEventListener({ eventName: \"mouseup\", callback: setNotActive, ref });\n\n  // Used to finish active transition if clicked on enter\n  useEventListener({ eventName: \"transitionend\", callback: setNotActive, ref });\n\n  // Key events\n  useKeyEvent({ keys: ENTER_KEYS, ref, callback: setActiveOnEnter });\n\n  const classNames = useMemo(\n    () =>\n      cx(\n        styles.button,\n        getStyle(styles, camelCase(\"kind-\" + kind)),\n        getStyle(styles, camelCase(\"color-\" + color)),\n        {\n          [styles.mainActive]: active,\n          [styles.active]: isActive,\n          [styles.splitContentOpen]: isDialogOpen,\n          [styles.hovered]: isHovered,\n          [styles.disabled]: disabled\n        },\n        className\n      ),\n    [className, kind, color, active, isActive, isDialogOpen, isHovered, disabled]\n  );\n\n  const dialogShowTrigger = useMemo(() => (disabled ? [] : DEFAULT_DIALOG_SHOW_TRIGGER), [disabled]);\n\n  const dialogHideTrigger = useMemo(() => {\n    if (shouldCloseOnClickInsideDialog) return [...DEFAULT_DIALOG_HIDE_TRIGGER, HideShowEvent.CONTENT_CLICK];\n    return DEFAULT_DIALOG_HIDE_TRIGGER;\n  }, [shouldCloseOnClickInsideDialog]);\n\n  const actionsContent = useCallback(() => {\n    const content = typeof secondaryDialogContent === \"function\" ? secondaryDialogContent() : secondaryDialogContent;\n    return (\n      <DialogContentContainer type={DialogContentContainer.types.POPOVER} size={dialogPaddingSize}>\n        {content}\n      </DialogContentContainer>\n    );\n  }, [secondaryDialogContent, dialogPaddingSize]);\n\n  const animationEdgePosition = useMemo(() => {\n    if (secondaryDialogPosition === \"bottom\") {\n      return \"\";\n    }\n    if (secondaryDialogPosition === \"bottom-start\") {\n      return \"bottom\";\n    }\n\n    return \"top\";\n  }, [secondaryDialogPosition]);\n\n  return (\n    <div\n      className={classNames}\n      ref={ref}\n      id={id}\n      data-testid={dataTestId || getTestId(ComponentDefaultTestId.SPLIT_BUTTON, id)}\n    >\n      <Button\n        {\n          ...buttonProps /* We are enriching button with other props so we must use spreading */\n        }\n        preventClickAnimation\n        leftIcon={leftIcon}\n        rightIcon={rightIcon}\n        rightFlat\n        color={color}\n        kind={kind}\n        active={active}\n        onClick={onClick}\n        className={styles.mainButton}\n        marginLeft={marginLeft}\n        onFocus={setHovered}\n        onBlur={setNotHovered}\n        disabled={disabled}\n        loading={loading}\n        data-testid={getTestId(ComponentDefaultTestId.SPLIT_BUTTON_PRIMARY_BUTTON, id)}\n      >\n        {children}\n      </Button>\n      <div className={styles.secondaryButtonWrapper}>\n        <Dialog\n          wrapperClassName={secondaryDialogClassName}\n          zIndex={zIndex}\n          content={actionsContent}\n          position={secondaryDialogPosition as DialogPosition}\n          containerSelector={dialogContainerSelector}\n          startingEdge={animationEdgePosition}\n          animationType={AnimationType.EXPAND}\n          moveBy={DIALOG_MOVE_BY}\n          onDialogDidShow={showDialog}\n          onDialogDidHide={hideDialog}\n          showTrigger={dialogShowTrigger}\n          hideTrigger={dialogHideTrigger}\n        >\n          <Button\n            {...buttonProps}\n            ref={secondaryButtonRef}\n            preventClickAnimation\n            leftFlat\n            noSidePadding\n            color={color}\n            kind={kind}\n            className={styles.secondaryButton}\n            active={isDialogOpen}\n            marginRight={marginRight}\n            onFocus={setHovered}\n            onBlur={setNotHovered}\n            disabled={disabled}\n            ariaLabel={SECONDARY_BUTTON_ARIA_LABEL}\n            ariaHasPopup\n            ariaExpanded={isDialogOpen}\n            data-testid={getTestId(ComponentDefaultTestId.SPLIT_BUTTON_SECONDARY_BUTTON, id)}\n          >\n            <div className={styles.secondaryButtonIconWrapper}>\n              <DropdownChevronDown aria-hidden=\"true\" />\n            </div>\n          </Button>\n        </Dialog>\n      </div>\n    </div>\n  );\n};\n\nSplitButton.defaultProps = {\n  ...Button.defaultProps,\n  onSecondaryDialogDidShow: NOOP,\n  onSecondaryDialogDidHide: NOOP,\n  zIndex: null,\n  secondaryDialogClassName: \"\",\n  secondaryDialogPosition: \"bottom-start\",\n  dialogPaddingSize: DialogContentContainer.sizes.MEDIUM\n};\n\nexport default withStaticProps(SplitButton, {\n  secondaryPositions: SplitButtonSecondaryContentPosition,\n  secondaryDialogPositions: SplitButtonSecondaryContentPosition,\n  sizes: Button.sizes,\n  colors: Button.colors,\n  kinds: Button.kinds,\n  inputTags: Button.inputTags,\n  dialogPaddingSizes: DialogContentContainer.sizes\n});\n"],"names":["SplitButton","_a","secondaryDialogContent","_a$onSecondaryDialogD","onSecondaryDialogDidShow","NOOP","_a$onSecondaryDialogD2","onSecondaryDialogDidHide","shouldCloseOnClickInsideDialog","_a$zIndex","zIndex","secondaryDialogClassName","_a$secondaryDialogPos","secondaryDialogPosition","dialogContainerSelector","_a$dialogPaddingSize","dialogPaddingSize","DialogContentContainer","sizes","MEDIUM","disabled","loading","kind","color","className","leftIcon","rightIcon","onClick","children","marginLeft","marginRight","active","id","dataTestId","buttonProps","__rest","_useState","useState","_useState2","_slicedToArray","isDialogOpen","setDialogOpen","_useState3","_useState4","isHovered","setIsHover","_useState5","_useState6","isActive","setIsActive","ref","useRef","secondaryButtonRef","setHovered","useCallback","setNotHovered","shouldSetActive","e","isInsideClass","target","SECONDARY_BUTTON_WRAPPER_CLASSNAME","setActive","setNotActive","setActiveOnEnter","showDialog","hideDialog","_","eventName","current","focus","useEventListener","callback","useKeyEvent","keys","ENTER_KEYS","classNames","useMemo","cx","styles","button","getStyle","camelCase","_defineProperty","mainActive","splitContentOpen","hovered","dialogShowTrigger","DEFAULT_DIALOG_SHOW_TRIGGER","dialogHideTrigger","concat","_toConsumableArray","DEFAULT_DIALOG_HIDE_TRIGGER","HideShowEvent","CONTENT_CLICK","actionsContent","content","React","createElement","type","types","POPOVER","size","animationEdgePosition","getTestId","ComponentDefaultTestId","SPLIT_BUTTON","Button","Object","assign","preventClickAnimation","rightFlat","mainButton","onFocus","onBlur","SPLIT_BUTTON_PRIMARY_BUTTON","secondaryButtonWrapper","Dialog","wrapperClassName","position","containerSelector","startingEdge","animationType","AnimationType","EXPAND","moveBy","DIALOG_MOVE_BY","onDialogDidShow","onDialogDidHide","showTrigger","hideTrigger","leftFlat","noSidePadding","secondaryButton","ariaLabel","SECONDARY_BUTTON_ARIA_LABEL","ariaHasPopup","ariaExpanded","SPLIT_BUTTON_SECONDARY_BUTTON","secondaryButtonIconWrapper","DropdownChevronDown","defaultProps","withStaticProps","secondaryPositions","SplitButtonSecondaryContentPosition","secondaryDialogPositions","colors","kinds","inputTags","dialogPaddingSizes"],"mappings":"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"}